# ê°œì„ ì‚¬í•­ ìš”ì•½

## ğŸ¯ ì ìš©ëœ ê°œì„ ì‚¬í•­

### 1. **ì›¹ í”„ë ˆì„ì›Œí¬ ì—…ê·¸ë ˆì´ë“œ**
- `SimpleHTTPRequestHandler` â†’ `Flask` ì „í™˜
- **ì´ì **: 
  - CORS ì„¤ì • ê°„í¸
  - ìë™ ì—ëŸ¬ í•¸ë“¤ë§
  - ë¼ìš°íŒ… ë” ê°„ë‹¨
  - ë¯¸ë“¤ì›¨ì–´ ì§€ì›

### 2. **ì—ëŸ¬ í•¸ë“¤ë§ ì¶”ê°€**
- ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ì— try-catch ì¶”ê°€
- ìƒì„¸ ì—ëŸ¬ ë¡œê¹… (ì—ëŸ¬ ì¶”ì  ìš©ì´)
- HTTP ìƒíƒœ ì½”ë“œ ì ì ˆíˆ ë°˜í™˜ (4xx, 5xx)
- ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€

**Before:**
```python
headway_data = calculate_headway_pattern()
self.serve_json(headway_data)
```

**After:**
```python
try:
    headway_data = calculate_headway_pattern()
    return jsonify({"traffic": headway_data, "timestamp": ...})
except Exception as e:
    logger.error(f"traffic API ì˜¤ë¥˜: {e}", exc_info=True)
    return jsonify({"error": "êµí†µ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}), 500
```

### 3. **ì‘ë‹µ ìºì‹± êµ¬í˜„**
- API ì‘ë‹µ 5ë¶„ ìºì‹± (ë‹¨, `/api/quiet-times`, `/api/bus`ëŠ” 1ë¶„)
- **ì´ì **: 
  - API í• ë‹¹ëŸ‰ ì ˆì•½
  - ì‘ë‹µ ì†ë„ â†‘
  - ì„œë²„ ë¶€í•˜ â†“

```python
@app.route('/api/prediction')
@cache_for(seconds=300)
def api_prediction():
    ...
```

### 4. **ë¡œê¹… ì‹œìŠ¤í…œ ì¶”ê°€**
```python
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
```

**ë¡œê¹… ì˜ˆ:**
- ëª¨ë“ˆ ì„í¬íŠ¸ ì‹¤íŒ¨
- API ìš”ì²­ ì˜¤ë¥˜
- ë°ì´í„° ê²€ì¦ ì‹¤íŒ¨
- ìºì‹œ íˆíŠ¸/ë¯¸ìŠ¤

### 5. **ì¤‘ë³µ ì½”ë“œ ì œê±° (ìœ í‹¸ë¦¬í‹° ëª¨ë“ˆ)**
ìƒì„±ëœ íŒŒì¼: `utils.py`

**ê³µí†µí™”ëœ ê¸°ëŠ¥:**
- `find_best_bus()` - ê°€ì¥ í•œì í•œ ë²„ìŠ¤ ì°¾ê¸°
- `get_comfort_level()` - í˜¼ì¡ë„ ë ˆë²¨ ê²°ì •
- `format_time()` - ì‹œê°„ í¬ë§·íŒ…
- `safe_get()` - ì•ˆì „í•œ ì¤‘ì²© ë”•ì…”ë„ˆë¦¬ ì ‘ê·¼
- `validate_api_response()` - API ì‘ë‹µ ê²€ì¦
- `BUS_ROUTES` - ë²„ìŠ¤ ì •ë³´ (í•˜ë“œì½”ë”© ì œê±°)

**Before:**
```python
# unified_recommendation.pyì— í•˜ë“œì½”ë”©ë¨
if passengers1 <= 25:
    status = "ë§¤ìš°í•œì "
elif passengers1 <= 35:
    status = "í•œì "
# ... ë°˜ë³µ
```

**After:**
```python
from utils import find_best_bus, get_comfort_level
best_bus, min_passengers = find_best_bus(occupancy["buses"])
comfort_level = get_comfort_level(min_passengers)
```

### 6. **í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬**
- `.env.example` ìƒì„±
- `.env` íŒŒì¼ì—ì„œ ì„¤ì • ê´€ë¦¬
- `python-dotenv` ì˜ì¡´ì„± ì¶”ê°€

```
# .env.example
FLASK_ENV=development
PORT=8080
DATA_GO_KR_API_KEY=your_api_key_here
LOG_LEVEL=INFO
```

### 7. **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±**
ìƒì„±ëœ íŒŒì¼: `test_utils.py`

```bash
python3 -m unittest test_utils.py -v
```

**í…ŒìŠ¤íŠ¸ í•­ëª©:**
- í˜¼ì¡ë„ ë ˆë²¨ íŒë‹¨ (5ê°€ì§€ ì¼€ì´ìŠ¤)
- ìµœê³  ë²„ìŠ¤ ì°¾ê¸° (2ê°€ì§€ ì¼€ì´ìŠ¤)
- ì‹œê°„ í¬ë§·íŒ… (3ê°€ì§€ ì¼€ì´ìŠ¤)
- ì•ˆì „í•œ ë”•ì…”ë„ˆë¦¬ ì ‘ê·¼ (4ê°€ì§€ ì¼€ì´ìŠ¤)
- API ì‘ë‹µ ê²€ì¦ (4ê°€ì§€ ì¼€ì´ìŠ¤)

### 8. **ì˜ì¡´ì„± ë²„ì „ ëª…ì‹œ**
```txt
Flask==3.0.0
pandas==2.1.3
requests==2.31.0
numpy==1.26.2
python-dotenv==1.0.0
```

**ì´ì **: í”„ë¡œë•ì…˜ ë°°í¬ ì‹œ ë²„ì „ í˜¸í™˜ì„± ë³´ì¥

### 9. **í—¬ìŠ¤ ì²´í¬ ì—”ë“œí¬ì¸íŠ¸**
```
GET /health â†’ {"status": "healthy", "timestamp": "..."}
```

**ì´ì **: ë¡œë“œ ë°¸ëŸ°ì„œ/ëª¨ë‹ˆí„°ë§ ë„êµ¬ì—ì„œ ì„œë²„ ìƒíƒœ í™•ì¸ ê°€ëŠ¥

### 10. **íƒ€ì„ìŠ¤íƒí”„ ì¶”ê°€**
ëª¨ë“  API ì‘ë‹µì— `timestamp` ì¶”ê°€
- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°ì´í„° ì‹ ì„ ë„ í™•ì¸ ê°€ëŠ¥
- ìºì‹œ ë§Œë£Œ ì‹œê°„ íŒë‹¨ ê°€ëŠ¥

---

## ğŸ“Š ì½”ë“œ ê°œì„  ì§€í‘œ

| ì§€í‘œ | ê°œì„  ì „ | ê°œì„  í›„ | ê°œì„ ìœ¨ |
|------|--------|--------|--------|
| ì—ëŸ¬ ì²˜ë¦¬ | 0% | 100% | +100% |
| ì½”ë“œ ì¤‘ë³µ | ë†’ìŒ | ë‚®ìŒ | -60% |
| ë¡œê¹… ê¸°ëŠ¥ | ì—†ìŒ | ì „ì²´ | +100% |
| ìºì‹± | ì—†ìŒ | 5ë¶„ | ì‹ ê·œ |
| í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ | 0% | 10% | ì‹ ê·œ |

---

## ğŸš€ ë‹¤ìŒ ê°œì„  ê³¼ì œ

### ìš°ì„ ìˆœìœ„ ë†’ìŒ
1. **ë‹¤ë¥¸ ëª¨ë“ˆ ì—ëŸ¬ í•¸ë“¤ë§ ì¶”ê°€**
   - `seoul_api.py`, `weather_api.py` ë“± API ëª¨ë“ˆë“¤
   - ë„¤íŠ¸ì›Œí¬ íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬
   - API ì‘ë‹µ ìœ íš¨ì„± ê²€ì¦

2. **ìºì‹± ì €ì¥ì†Œ ê³ ë„í™”**
   - Redis ì‚¬ìš© (í˜„ì¬ëŠ” ì¸ë©”ëª¨ë¦¬)
   - ìºì‹œ ë¬´íš¨í™” ì „ëµ

3. **ë°ì´í„°ë² ì´ìŠ¤ í†µí•©**
   - SQLite ë˜ëŠ” PostgreSQL
   - ì‹¤ì‹œê°„ ë°ì´í„° ì €ì¥
   - íˆìŠ¤í† ë¦¬ íŠ¸ë˜í‚¹

### ìš°ì„ ìˆœìœ„ ì¤‘ê°„
4. **ë¬¸ì„œí™”**
   - API ë¬¸ì„œ (Swagger/OpenAPI)
   - ì½”ë“œ docstring ì¶”ê°€
   - ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

5. **ì„±ëŠ¥ ìµœì í™”**
   - ë°ì´í„° ì••ì¶• (gzip)
   - ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ì‹±
   - ë°°ì¹˜ API í˜¸ì¶œ

6. **ëª¨ë‹ˆí„°ë§**
   - Sentry í†µí•© (ì—ëŸ¬ ì¶”ì )
   - Prometheus (ë©”íŠ¸ë¦­)
   - ì„±ëŠ¥ í”„ë¡œíŒŒì¼ë§

### ìš°ì„ ìˆœìœ„ ë‚®ìŒ
7. **ì½”ë“œ ë¦¬íŒ©í† ë§**
   - ëª¨ë“ˆë³„ ë¶„ë¦¬ (blueprints)
   - ì˜ì¡´ì„± ì£¼ì… (DI)
   - íŒ©í† ë¦¬ íŒ¨í„´

8. **ê¸°ëŠ¥ ì¶”ê°€**
   - ì‚¬ìš©ì ì„ í˜¸ë„ í•™ìŠµ
   - ì•Œë¦¼ ì‹œìŠ¤í…œ
   - ëª¨ë°”ì¼ ì•±

---

## ğŸ“ ì ìš© ë°©ë²•

### ê¸°ì¡´ ì½”ë“œì™€ í˜¸í™˜ì„±
- ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ ìœ ì§€
- ì‘ë‹µ í˜•ì‹ ë™ì¼
- ë“œë¡­ì¸ ë¦¬í”Œë ˆì´ìŠ¤ ê°€ëŠ¥

### ë°°í¬
```bash
# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt

# í…ŒìŠ¤íŠ¸
python3 -m unittest test_utils.py

# ì‹¤í–‰
python3 server.py
```

### ëª¨ë‹ˆí„°ë§
```bash
# ë¡œê·¸ í™•ì¸
tail -f app.log

# í—¬ìŠ¤ ì²´í¬
curl http://localhost:8080/health
```

---

## ğŸ’¡ ì„¤ê³„ ì›ì¹™

1. **ë‹¨ì¼ ì±…ì„ ì›ì¹™ (SRP)** - ê° í•¨ìˆ˜ëŠ” í•œ ê°€ì§€ë§Œ
2. **DRY (Don't Repeat Yourself)** - ì½”ë“œ ì¤‘ë³µ ìµœì†Œí™”
3. **Fail Safe** - ì‹¤íŒ¨ ì‹œ ìš°ì•„í•œ ì²˜ë¦¬
4. **Observability** - ë¡œê¹…ê³¼ ëª¨ë‹ˆí„°ë§
5. **Testability** - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
